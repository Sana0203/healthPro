<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>HealthPro</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Favicon -->
    <link href="img/favicon.ico" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500&family=Roboto:wght@500;700;900&display=swap" rel="stylesheet"> 

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="lib/animate/animate.min.css" rel="stylesheet">
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />

    <!-- Customized Bootstrap Stylesheet -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<!-- Bootstrap JavaScript Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Template Stylesheet -->
    <link href="css/style.css" rel="stylesheet">
</head>

<body>
    <!-- Spinner Start -->
    <div id="spinner" class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
        <div class="spinner-grow text-primary" style="width: 3rem; height: 3rem;" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
    <!-- Spinner End -->


    <!-- Navbar Admin Start -->
    <nav class="navbar navbar-expand-lg bg-white navbar-light sticky-top p-0 wow fadeIn" data-wow-delay="0.1s">
        <a href="index.html" class="navbar-brand d-flex align-items-center px-4 px-lg-5">
            <h1 class="m-0 text-primary"><i class="far fa-hospital me-3"></i>HealthPro</h1>
        </a>
        <button type="button" class="navbar-toggler me-4" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
            <div class="navbar-nav ms-auto p-4 p-lg-0">
                <a href="dashboard_Admin.html" class="nav-item nav-link active">Dashboard</a>
                <div class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                        Manage Users
                    </a>
                    <div class="dropdown-menu rounded-0 rounded-bottom m-0">
                        <a href="user-approval.html" class="nav-item nav-link">Approve Pending Patients</a>
                        <a href="create-user.html" class="nav-item nav-link">Create Users</a>
                        <a href="delete-user.html" class="nav-item nav-link">Delete Users</a>
                    </div>
                </div>
                <a href="service.html" class="nav-item nav-link">Reports</a>
                <a href="service.html" class="nav-item nav-link">System Settings</a>
                <div class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                        Your Account
                    </a>
                    <div class="dropdown-menu rounded-0 rounded-bottom m-0">
                        <a href="profile-admin.html" class="dropdown-item">Profile</a>
                        <a href="setting-admin.html" class="dropdown-item">Setting</a>
                        <a href="login.html" class="dropdown-item">Sign out</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    <!-- Navbar End -->
<!-- Setting Start -->
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-lg-6 col-md-8 col-sm-12">
            <p class="d-inline-block border rounded-pill py-1 px-4">Setting</p>
            <h1 class="mb-4">Administrator Setting</h1>
            
            <!-- Change Profile Image Form -->
            <div class="bg-light rounded d-flex p-5 mb-4">
                <form id="settingProfileImageForm" enctype="multipart/form-data" class="w-100">
                    <h5>Change Profile Image</h5>
                    <div class="col-12">
                        <div class="profile-image text-center" id="profileImageContainer">
                            <input type="file" name="profileImage" id="profileImage" class="form-control border-0" style="display: none;" accept="image/*">
                            <img src="img/img.jpg" alt="Profile Image" class="rounded-circle pb-1" width="100" height="100" id="profileImagePreview" style="cursor: pointer;">
                        </div>
                    </div>
                    <div class="col-12" style="display: none;" id="imageError">
                        <p class="text-danger" id="imageErrorMessage">Please complete the form with valid inputs!</p>
                    </div>
                    <div class="col-12">
                        <button class="btn btn-primary w-100 py-3" type="submit">Save Changes</button>
                    </div>
                </form>
            </div>

            <!-- Change Password Form -->
            <div class="bg-light rounded d-flex p-5">
                <form id="settingPassChangeForm" class="w-100">
                    <h5>Change Password</h5>
                    <div class="col-12 mb-3">
                        <input required type="password" name="oldPassword" id="oldPassword" class="form-control border-0" placeholder="Old Password" style="height: 55px;">
                    </div>
                    <div class="col-12 mb-3">
                        <input required type="password" name="newPassword" id="newPassword" class="form-control border-0" placeholder="New Password" style="height: 55px;">
                    </div>
                    <div class="col-12 mb-3">
                        <input required type="password" name="confirmPassword" id="confirmPassword" class="form-control border-0" placeholder="Confirm Password" style="height: 55px;">
                    </div>
                    <div class="col-12" style="display: none;" id="passwordError">
                        <p class="text-danger" id="passwordErrorMessage">Please complete the form with valid inputs!</p>
                    </div>
                    <div class="col-12">
                        <button class="btn btn-primary w-100 py-3" type="submit">Change Password</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- Setting End -->

<!-- Back to Top -->
<a href="#" class="btn btn-lg btn-primary btn-lg-square rounded-circle back-to-top"><i class="bi bi-arrow-up"></i></a>


<!-- JavaScript Libraries -->
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="lib/wow/wow.min.js"></script>
<script src="lib/easing/easing.min.js"></script>
<script src="lib/waypoints/waypoints.min.js"></script>
<script src="lib/counterup/counterup.min.js"></script>
<script src="lib/owlcarousel/owl.carousel.min.js"></script>
<script src="lib/tempusdominus/js/moment.min.js"></script>
<script src="lib/tempusdominus/js/moment-timezone.min.js"></script>
<script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>

<!-- Template Javascript -->
<script src="js/main.js"></script>

<script>
    // Change Password and Image Form Submission
    // Change Password Form Submission
    const settingPassChangeForm = document.getElementById('settingPassChangeForm');
    if (settingPassChangeForm) {
        settingPassChangeForm.addEventListener('submit', async (e) => {
            // Define the variables for the form
            const oldPassword = document.getElementById('oldPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const passwordError = document.getElementById("passwordError");
            const passwordErrorMessage = document.getElementById("passwordErrorMessage");

            // Prevent page from reloading
            e.preventDefault();

            let errorMessage = [];
            
            // Validate Old Password
            const storedPassword = JSON.parse(localStorage.getItem('user'));
            if (oldPassword === '') {
                errorMessage.push("Old password is required");
            } else if (oldPassword !== storedPassword.Password) {
                errorMessage.push("Old password does not match");
            }

            // Validate New Password
            if (newPassword === '') {
                errorMessage.push("New password is required");
            } else if (newPassword.length < 6) {
                errorMessage.push("New password must be at least 6 characters long");
            }

            // Validate Confirm Password
            if (confirmPassword === '') {
                errorMessage.push("Confirm password is required");
            } else if (newPassword !== confirmPassword) {
                errorMessage.push("New password and confirm password do not match");
            }

            // Show error messages if any
            if (errorMessage.length > 0) {
                passwordError.style.display = "block";
                passwordErrorMessage.innerText = errorMessage.join(", ");
            } else {
                // Proceed with form submission or further processing
                passwordError.style.display = "none";

                // Prepare data to send to the backend
                const userId = storedPassword.UserID; // Assuming UserID is stored in localStorage
                const data = {
                    UserID: userId,
                    NewPassword: newPassword
                };

                try {
                    // Send the new password to the backend
                    const response = await fetch('http://localhost:5501/api/change_password', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data),
                    });

                    const result = await response.json();

                    if (response.ok) {
                        // Show success alert
                        alert('Password changed successfully!');
                        // Update password in local storage
                        storedPassword.Password = newPassword;
                        localStorage.setItem('user', JSON.stringify(storedPassword));
                        // Reset the form
                        settingPassChangeForm.reset();
                    } else {
                        // Handle error response
                        passwordError.style.display = "block";
                        passwordErrorMessage.innerText = result.error;
                    }
                } catch (error) {
                    console.error('Error changing password:', error);
                    passwordError.style.display = "block";
                    passwordErrorMessage.innerText = 'Failed to change password. Please try again.';
                }
            }
        });
    }

    document.addEventListener('DOMContentLoaded', () => {

        const userData = {
            UserID: "removed",
            WorkID: 'A001',
            UserType: "Administrator",
            Name: "Sarah Lee",
            Email: "sarahlee@healthpro.com",
            PhoneNumber: "555-987-6543",
            DateOfBirth: "1975-03-14",
            Password: "password",
            Image:"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"
        }

        localStorage.setItem('user', JSON.stringify(userData));

        const profileImageInput = document.getElementById('profileImage');
        const profileImagePreview = document.getElementById('profileImagePreview');
        const defaultImageSrc = 'img/profileimage.png'; // Path to your default image

        // Load the existing image from local storage if available
        const storedUser  = JSON.parse(localStorage.getItem('user'));
        if (storedUser  && storedUser.Image) {
            profileImagePreview.src = storedUser.Image; // Load image from local storage
        } else {
            profileImagePreview.src = defaultImageSrc; // Set default image if no image is found
        }

        // Make the profile image clickable to trigger the file input
        profileImagePreview.addEventListener('click', () => {
            profileImageInput.click();
        });

        // Handle the file selection
        profileImageInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    // Display the image in the preview
                    profileImagePreview.src = event.target.result;

                    // Update the user object in local storage
                    if (storedUser ) {
                        storedUser .image = event.target.result;
 localStorage.setItem('user', JSON.stringify(storedUser ));
                    }
                };
                reader.readAsDataURL(file);
            }
        });

        // Handle form submission to save changes (if needed)
        const settingProfileImageForm = document.getElementById('settingProfileImageForm');
        settingProfileImageForm.addEventListener('submit', (e) => {
            e.preventDefault();
            alert('Profile image updated successfully!');
        });
    });
</script>

</body>
</html>